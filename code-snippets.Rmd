---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

```{r}
library(reticulate)
```

```{bash}
pip install plotly
```

```{python}
import pandas as pd
import plotly.express as px
import numpy as np

zipcounty = pd.read_csv('/Users/nancy/Downloads/zipcounty.txt', sep='\t' , encoding='latin-1')

zipcounty['zipcode'] = zipcounty['zipcode'].astype(str)

zipcensus = pd.read_csv('/Users/nancy/Downloads/ZipCensus_ss.txt', sep='\t' , encoding='latin-1')

orders = pd.read_csv('/Users/nancy/Downloads/orders.txt', sep='\t' , encoding='latin-1')

grouped = orders.groupby(['zipcode'])['city', 'state', 'totalprice'].agg('sum').reset_index()

merged = pd.merge(grouped, zipcounty[['zipcode', 'latitude', 'longitude']], on='zipcode')

merged.columns = ['zipcode', 'totalprice', 'Latitude', 'Longitude']

merged = merged[merged['totalprice'] > 0]

merged['log_totalprice'] = np.log(merged['totalprice'])

px.set_mapbox_access_token("pk.eyJ1IjoibmQ4MjMiLCJhIjoiY2p1aDNheXltMHNuNTN6bng2Mjc0a2ZyOSJ9.aJwWqjS3PZcYKVckxisUNg")

fig = px.scatter_mapbox(merged, lat="Latitude", lon="Longitude", size="log_totalprice", color = "log_totalprice",  color_continuous_scale=px.colors.diverging.RdYlGn[::-1], size_max=20, zoom=3)

fig.show()
```

```{python}
import datetime as dt

orders['ordermonth'] = pd.DatetimeIndex(orders['orderdate']).month
```

```{python}
x = orders.groupby(['ordermonth'])['totalprice'].agg('sum').reset_index()
```

```{bash}
pip install plotly
```

```{python}
orders.head().T
```

```{python}
from plotly import graph_objs as go
 
import datetime
import numpy as np
np.random.seed(1)



fig = go.Figure(data=go.Heatmap(
        z=orders['totalprice'],
        x=orders['orderdate'],
        y=orders['paymenttype'],
        colorscale='Viridis'))

fig.update_layout(
    title='GitHub commits per day',
    xaxis_nticks=36)

fig.show()


```
Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

